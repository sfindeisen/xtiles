<?xml version="1.0" encoding="UTF-8"?>

<xtiles-config xmlns="http://www.xtiles.org/XML/ns/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.xtiles.org/XML/ns/ xtiles-config.xsd"
    version="0.1">

    <!-- file is required, xpath is optional -->
    <match file="post/*.xml" xpath="body/">
        <!-- special variables (for each match): file, xpath, nodes -->
        <!-- apply-template: at least 1 of: var, output must be specified;
             var means to store the result in a variable
             output means to store the result in a file -->
        <apply-template template="tpl/post-layout.html" var="post">
            <param name="body"     value="$nodes"/>
            <param name="date"     value="$current-date()"/>
            <param name="title"    value="$xpath/meta/title/text()$ - my $$ page"/>
            <param name="filename" value="$name(file)"/>
            <param name="my_const" value="some constant value"/>
        </apply-template>

        <!-- save post variable contents in a file -->
        <save src="post" file="post/simple/$basename(file)$.html"/>

        <!-- apply another template, store the result directly in a file -->
        <apply-template template="tpl/default-layout.html" output="post/$basename(file)$.html">
            <param name="body"     value="$post"/>
            <param name="title"    value="my title"/>
        </apply-template>
    </match>

    <!-- up to 1 * in file pattern -->
    <match file="css/*.css">
        <!-- just copy the matching file -->
        <copy src="$file" dst="out/css/$name(file)"/>
    </match>

    <!-- create a file (file is a required attribute) -->
    <create file="summary.html">
        <!-- select node sets from a bunch of files, TODO order by, concatenate, store in a variable -->
        <select file="post/*.xml" xpath="meta/date/text()" var="x"/>
        <!-- new variable: x is now a single node set
             x is immutable
             x scope is the enclosing element -->

        <apply-template template="tpl/post-summary.html">
            <!-- no output file needed as it is already on create element level;
                 inside the template we can use a node list! -->
            <param name="all_dates" value="$x"/>
        </apply-template>
    </create>
</xtiles-config>
